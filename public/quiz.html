<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/quiz.css">
    <link rel="shortcut icon" href="./assets/icones/favIcon.ico" type="image/x-icon">
    <script src="./js/sessao.js"></script>
    <title>Quiz | O Rappa</title>
</head>

<body>
    <div class="boxQuiz" id="quiz">
        <h1 id="mensagemBemVindo">BEM VINDO!</h1><br>
        <h2 id="perguntaNumero"></h2>
        <span id="mensagem">CLIQUE NO BOTÃO ABAIXO PARA INICIAR O QUIZ, BOA SORTE!</span>
        <div id="question"></div>
        <div id="options"></div>
        <button id="iniciar" onclick="iniciarQuiz()">INICIAR QUIZ</button>

    </div>
    <div class="midiaQuiz">
        <video autoplay muted loop>
            <source src="./assets/O_Rappa_Anjos.mp4" type="video/mp4">
            <audio id="audioPlayer" src="./assets/O_Rappa_Anjos _.mp3"></audio>
        </video>
    </div>
</body>

</html>

<script>
    document.getElementById('iniciar').addEventListener('click', function () {
        var audioPlayer = document.getElementById('audioPlayer');
        audioPlayer.play();
    }); // puxa o botão pelo id, adiciona um evento ao clicar, seleciona o som pelo id e por fim, toca a música

    const quizData = [
        {
            question: "QUAL FOI O ANO DE FORMAÇÃO DA BANDA O RAPPA?",
            options: ["1991", "1992", "1993", "1994"],
            answer: "1993"
        },
        {
            question: "ENTRE OS INTEGRANTES DA BANDA, DOIS DELES POSSUEM O PRIMEIRO NOME IGUAL, QUAL É ESSE NOME?",
            options: ["LAURO", "MARCOS", "DIEGO", "MARCELO"],
            answer: "MARCELO"
        },
        {
            question: "QUAL É O NOME DO PRIMEIRO ÁLBUM DA BANDA O RAPPA?",
            options: ["RAPPA Mundi", "O RAPPA", "LADO B LADO A", "NUNCA TEM FIM..."],
            answer: "O RAPPA"
        },
        {
            question: "QUAL CANÇÃO DE O RAPPA FALA SOBRE A DESIGUALDADE SOCIAL E FOI LANÇADA NO ÁLBUM 'LADO B LADO A'?",
            options: ["O Que Sobrou do Céu", "Minha Alma", "A Feira", "Me Deixa"],
            answer: "Minha Alma"
        },
        {
            question: "QUAL É A MÚSICA DO O RAPPA QUE TEM A LETRA '...ESTÁ ARMADA E APONTADA PARA A CARA DO SOSSEGO'?",
            options: ["ANJOS", "ME DEIXA", "O QUE SOBROU DO CÉU", "MINHA ALMA"],
            answer: "MINHA ALMA"
        },
        {
            question: "QUAL MÚSICA DE O RAPPA TEM A LETRA 'SE MEUS JOELHOS NÃO DOESSEM MAIS'?",
            options: ["ANJOS", "PESCADOR DE ILUSÕES", "O QUE SOBROU DO CÉU", "MINHA ALMA"],
            answer: "PESCADOR DE ILUSÕES"
        },
        {
            question: "EM QUAL CIDADE O RAPPA FOI FORMADO?",
            options: ["SÃO PAULO", "SALVADOR", "RIO DE JANEIRO", "BELO HORIZONTE"],
            answer: "RIO DE JANEIRO"
        },
        {
            question: "QUAL ANIMAL APARECE NA CAPA DO DISCO 'O SILÊNCIO Q PRECEDE O ESPORRO'?",
            options: ["DRAGÃO", "PEIXE", "COBRA", "LAGARTO"],
            answer: "DRAGÃO"
        },
        {
            question: "AO LER A HISTÓRIA DA BANDA, FOI CITADO O INTUITO DE SUA CRIAÇÃO, ACOMPANHAR UM CANTOR QUE ESTAVA EM TURNE NO BRASIL, QUAL ERA O NOME DO CANTOR?",
            options: ["PLANET HEMP", "BOB MARLEY", "CHARLIE BROWN", "PAPA WINIE"],
            answer: "PAPA WINIE"
        },
        {
            question: "QUAL ÁLBUM, CONTENDO VIDEOCLIPES ICÔNICOS E MENSAGENS DE RESISTÊNCIA QUE INFLUENCIARAM PROFUNDAMENTE A MÚSICA BRASILEIRA E CONTINUAM A RESSOAR COM NOVAS GERAÇÕES, TEVE O MAIOR IMPACTO CULTURAL?",
            options: ["NUNCA TEM FIM...", "LADO B LADO A", "O SILÊNCIO Q PRECEDE O ESPORRO", "RAPPA MUNDI"],
            answer: "LADO B LADO A"
        },
        {
            question: "EM QUE ANO O RAPPA ANUNCIOU SEU TÉRMINO?",
            options: ["2015", "2017", "2018", "2020"],
            answer: "2017"
        },

    ];

    let score = 0;

    function iniciarQuiz() {
        document.getElementById("iniciar").style.display = 'none';
        document.getElementById("mensagemBemVindo").style.display = 'none';
        document.getElementById("mensagem").style.display = 'none';


        const questionElement = document.getElementById("question");
        const optionsElement = document.getElementById("options");

        let currentQuestion = 0;
        score = 0;

        function showQuestion() {
            const question = quizData[currentQuestion];
            questionElement.innerText = question.question;

            perguntaNumero.innerHTML = `Pergunta ${currentQuestion + 1}`

            optionsElement.innerHTML = "";
            question.options.forEach(option => {
                const button = document.createElement("button");
                button.innerText = option;
                optionsElement.appendChild(button);
                button.addEventListener("click", selectAnswer);
            });
        }

        function selectAnswer(e) {
            const selectedButton = e.target;
            const answer = quizData[currentQuestion].answer;

            if (selectedButton.innerText === answer) {
                score++;
            }

            currentQuestion++;

            if (currentQuestion < quizData.length) {
                showQuestion();
            } else {
                enviar();
                showResult();
            }


        }

        function showResult() {
            document.getElementById("quiz").innerHTML = `
                <h1>Quiz Concluído</h1>
                <p>Você acertou ${score} de um total de ${quizData.length} questões</p>
                <button class="restart" onclick="reiniciarQuiz()">Recomeçar Quiz</button>
                <a id="restartText" class="restart" href="./dashboard.html">Voltar para Dashboard</a>
            `;
        }
        showQuestion();
    }
    function enviar() {
        fetch("/quiz/enviar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                usuarioServer: sessionStorage.ID_USUARIO,
                scoreServer: score
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }


    function reiniciarQuiz() {
        document.getElementById("quiz").innerHTML = `
        <h1 id="mensagemBemVindo">Bem Vindo!</h1><br>
        <h2 id="perguntaNumero"></h2>
        <span id="mensagem">Clique no botão abaixo para iniciar o quiz, boa sorte!</span>
        <div id="question"></div>
        <div id="options"></div>
        <button id="iniciar" onclick="iniciarQuiz()">Iniciar Quiz</button>
        `;
    }

    function voltarDash() {
        window.location = "./dashboard.html"
    }
</script>