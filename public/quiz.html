<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/quiz.css">
    <link rel="shortcut icon" href="./assets/icones/favIcon.ico" type="image/x-icon">
    <script src="./js/sessao.js"></script>
    <title>Quiz | O Rappa</title>
</head>

<body>
    <div class="boxQuiz" id="quiz">
        <h1 id="mensagemBemVindo">Bem Vindo!</h1><br>
        <h2 id="perguntaNumero"></h2>
        <span id="mensagem">Clique no botão abaixo para iniciar o quiz, boa sorte!</span>
        <div id="question"></div>
        <div id="options"></div>
        <button id="iniciar" onclick="iniciarQuiz()">Iniciar Quiz</button>

    </div>
    <div class="midiaQuiz">
        <video autoplay muted loop>
            <source src="./assets/O_Rappa_Anjos.mp4" type="video/mp4">
            <audio id="audioPlayer" src="./assets/O_Rappa_Anjos _.mp3"></audio>
        </video>
    </div>
</body>

</html>

<script>
    document.getElementById('iniciar').addEventListener('click', function () {
        var audioPlayer = document.getElementById('audioPlayer');
        audioPlayer.play();
    }); // puxa o botão pelo id, adiciona um evento ao clicar, seleciona o som pelo id e por fim, toca a música

    const quizData = [
        {
            question: "Qual foi o ano de formação da banda O Rappa?",
            options: ["1991", "1992", "1993", "1994"],
            answer: "1993"
        },
        {
            question: "Entre os integrantes da banda, dois deles possuem o primeiro nome igual, qual é esse nome?",
            options: ["Lauro", "Marcos", "Diego", "Marcelo"],
            answer: "Marcelo"
        },
        {
            question: "Qual é o nome do primeiro álbum da banda O Rappa?",
            options: ["Rappa Mundi", "O Rappa", "Lado B Lado A", "Nunca Tem Fim..."],
            answer: "O Rappa"
        },
        {
            question: "Qual canção de O Rappa fala sobre a desigualdade social e foi lançada no álbum 'Lado B Lado A'",
            options: ["O Que Sobrou do Céu", "Minha Alma", "A Feira", "Me Deixa"],
            answer: "Minha Alma"
        },
        {
            question: "Qual é a música do O Rappa que tem a letra '...está armada e apontada para a cara do sossego'",
            options: ["Anjos", "Me Deixa", "O Que Sobrou do Céu", "Minha Alma"],
            answer: "Minha Alma"
        },
        {
            question: "Qual música de O Rappa tem a letra 'Se meus joelhos não doessem mais'",
            options: ["Anjos", "Pescador de Ilusões", "O Que Sobrou do Céu", "Minha Alma"],
            answer: "Pescador de Ilusões"
        },
        {
            question: "Em qual cidade O Rappa foi formado?",
            options: ["São Paulo", "Salvador", "Rio de Janeiro", "Belo Horizonte"],
            answer: "Rio de Janeiro"
        },
        {
            question: "Qual animal aparece na capa do disco 'O Silêncio Q Precede O Esporro'?",
            options: ["Dragão", "Peixe", "Cobra", "Lagarto"],
            answer: "Dragão"
        },
        {
            question: "Ao ler a história da banda, foi citado o intuito de sua criação, acompanhar um cantor que estava em turne no Brasil, qual era o nome do cantor?",
            options: ["Planet Hemp", "Bob Marley", "Charlie Brown Jr.", "Papa Winnie"],
            answer: "Papa Winnie"
        },
        {
            question: "Qual álbum, contendo videoclipes icônicos e mensagens de resistência que influenciaram profundamente a música brasileira e continuam a ressoar com novas gerações, teve o maior impacto cultural?",
            options: ["Nunca Tem Fim...", "Lado B Lado A", "O Silêncio Q Precede o Esporro", "Rappa Mundi"],
            answer: "Lado B Lado A"
        },
        {
            question: "Em que ano O Rappa anunciou seu término?",
            options: ["2015", "2017", "2018", "2020"],
            answer: "2017"
        },

    ];

    let score = 0;

    function iniciarQuiz() {
        document.getElementById("iniciar").style.display = 'none';
        document.getElementById("mensagemBemVindo").style.display = 'none';
        document.getElementById("mensagem").style.display = 'none';


        const questionElement = document.getElementById("question");
        const optionsElement = document.getElementById("options");

        let currentQuestion = 0;
        score = 0;

        function showQuestion() {
            const question = quizData[currentQuestion];
            questionElement.innerText = question.question;

            perguntaNumero.innerHTML = `Pergunta ${currentQuestion + 1}`

            optionsElement.innerHTML = "";
            question.options.forEach(option => {
                const button = document.createElement("button");
                button.innerText = option;
                optionsElement.appendChild(button);
                button.addEventListener("click", selectAnswer);
            });
        }

        function selectAnswer(e) {
            const selectedButton = e.target;
            const answer = quizData[currentQuestion].answer;

            if (selectedButton.innerText === answer) {
                score++;
            }

            currentQuestion++;

            if (currentQuestion < quizData.length) {
                showQuestion();
            } else {
                enviar();
                showResult();
            }


        }

        function showResult() {
            document.getElementById("quiz").innerHTML = `
                <h1>Quiz Concluído</h1>
                <p>Você acertou ${score} de um total de ${quizData.length} questões</p>
                <button class="restart" onclick="reiniciarQuiz()">Recomeçar Quiz</button>
                <a id="restartText" class="restart" href="./dashboard.html">Voltar para Dashboard</a>
            `;
        }
        showQuestion();
    }
    function enviar() {
        fetch("/quiz/enviar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                usuarioServer: sessionStorage.ID_USUARIO,
                scoreServer: score
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }


    function reiniciarQuiz() {
        document.getElementById("quiz").innerHTML = `
        <h1 id="mensagemBemVindo">Bem Vindo!</h1><br>
        <h2 id="perguntaNumero"></h2>
        <span id="mensagem">Clique no botão abaixo para iniciar o quiz, boa sorte!</span>
        <div id="question"></div>
        <div id="options"></div>
        <button id="iniciar" onclick="iniciarQuiz()">Iniciar Quiz</button>
        `;
    }

    function voltarDash() {
        window.location = "./dashboard.html"
    }
</script>